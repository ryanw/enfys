import { Gfx, calculateNormals } from "engine";
import { PHI, Point3 } from "engine/math";
import { normalize } from "engine/math/vectors";
import { ColorInstance, ColorVertex, SimpleMesh } from "engine/mesh";

/**
 * Mesh shaped like an Icosahedron
 */
export class Icosahedron extends SimpleMesh {
	constructor(gfx: Gfx, instances?: Array<ColorInstance>) {
		const vertices = buildIcosahedron(position => ({
			softness: 0.0,
			position: [...position],
			normal: [0, 0, 0],
			color: BigInt(0xff00ddff),
		} as ColorVertex));
		calculateNormals(vertices);
		super(gfx, vertices, instances);
	}
}

export function buildIcosahedron<T>(callback: (position: Point3, index: number) => T): Array<T> {
	return ICOSAHEDRON_TRIS.map(
		(tri) => tri.map(
			(v, i) =>
				callback(normalize(ICOSAHEDRON_VERTICES[v]), i)
		)
	).flat();
}

export const ICOSAHEDRON_VERTICES: Array<Point3> = [
	[-1, PHI, 0],
	[1, PHI, 0],
	[-1, -PHI, 0],
	[1, -PHI, 0],
	[0, -1, PHI],
	[0, 1, PHI],
	[0, -1, -PHI],
	[0, 1, -PHI],
	[PHI, 0, -1],
	[PHI, 0, 1],
	[-PHI, 0, -1],
	[-PHI, 0, 1]
];

export const ICOSAHEDRON_TRIS: Array<[number, number, number]> = [
	[0, 11, 5],
	[0, 5, 1],
	[0, 1, 7],
	[0, 7, 10],
	[0, 10, 11],
	[1, 5, 9],
	[5, 11, 4],
	[11, 10, 2],
	[10, 7, 6],
	[7, 1, 8],
	[3, 9, 4],
	[3, 4, 2],
	[3, 2, 6],
	[3, 6, 8],
	[3, 8, 9],
	[4, 9, 5],
	[2, 4, 11],
	[6, 2, 10],
	[8, 6, 7],
	[9, 8, 1],
];

